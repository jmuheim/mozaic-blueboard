// Make sure to start the BlueBoard while pressing the B button!
@OnLoad
  SetShortName {1-ModeSwitcher}

  Call @InitConstants
  Call @InitSharedConstants
  Call @InitVariables
@End

@InitConstants
  MODE_STEP_SEQUENCER = 0
  MODE_STEP_SETUP     = 1
  MODE_STEP_SEQUENCER = 2
@End

@InitVariables
@End

@OnSysex
  ReceiveSysex data

  if data[0] = MOZ_INST_MODE_SWITCHER
    bbButton = data[1]
    tapType  = data[2]

    Log {Received button }, bbButton, { with tapType }, tapType

    Call @DispatchButtonPress
  endif
@End

@DispatchButtonPress
  // TODO: No real switch here yet...
  // Idea: we could use button combos for switching to a different mode, e.g. A+B, A+C, B+D, D+B (other way round) etc.
  currentMode = MODE_STEP_SEQUENCER

  if currentMode = MODE_STEP_SEQUENCER
    Call @SendButtonToStepSequencer
  elseif currentMode = MODE_STEP_SETUP
    Call @SendButtonToSetup // No yet implemented
  elseif currentMode = MODE_STEP_PEDAL
    Call @SendButtonToPedal // No yet implemented
  else
    Log {ERROR! Unknown currentMode: }, currentMode
  endif
@End

@SendButtonToStepSequencer
  SendSysex [MOZ_INST_STEP_SEQUENCER, bbButton, tapType], 3
@End







//////////////////////////////////////////////////////////
// These constants are shared across all Mozaic scripts //
//////////////////////////////////////////////////////////
@InitSharedConstants
  UNDEFINED = -1

  MOZ_INST_MODE_SWITCHER  = 1
  MOZ_INST_STEP_SEQUENCER = 21
@End
